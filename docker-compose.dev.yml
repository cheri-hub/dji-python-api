# ==============================================================
# DJI AG API - Docker Compose (Desenvolvimento)
# ==============================================================
version: '3.8'

services:
  api:
    build: .
    container_name: djiag-api-dev
    ports:
      - "8000:8000"
    environment:
      - DJI_USERNAME=${DJI_USERNAME}
      - DJI_PASSWORD=${DJI_PASSWORD}
      - API_KEY=${API_KEY}
      - API_HOST=0.0.0.0
      - API_PORT=8000
      - BROWSER_HEADLESS=false
      - BROWSER_PROFILE_DIR=/app/browser_profile
      - DOWNLOADS_DIR=/app/downloads
    volumes:
      # Código fonte para hot-reload
      - ./src:/app/src:ro
      # Persistir sessão do browser
      - ./browser_profile:/app/browser_profile
      # Persistir downloads
      - ./downloads:/app/downloads
    # Memória compartilhada para Chromium (OBRIGATÓRIO)
    shm_size: 2gb
    command: ["python", "-m", "uvicorn", "src.presentation.api:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
